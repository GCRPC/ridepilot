<% defined?(prefix) ? prefix : prefix = "address"%>
<% defined?(edit_mode) ? edit_mode : edit_mode = :new %>
<%= hidden_field_tag :lat, address.latitude, class: 'address_lat' %>
<%= hidden_field_tag :lon, address.longitude, class: 'address_lon' %>

<li class="selfclear">
  <%= form.label :name, translate_helper("address_name") %>
  <%= form.text_field :name %>
</li>

<li class="selfclear">
  <%= form.label :building_name, translate_helper("building_name") %>
  <%= form.text_field :building_name %>
</li>

<li class="selfclear">
  <%= label_tag "#{prefix}_use_geocoder", translate_helper("use_geocoder") %>
  <%= check_box_tag "#{prefix}_user_geocoder", 'yes', true, class: 'address_use_geocoder' %>
</li>

<li class="selfclear full_address">
  <%= label_tag "#{prefix}_full_address", translate_helper("full_address_name") %>
  <% if edit_mode == :edit %>
    <%= address.try(:address_text) %>
  <% else %>
    <%= text_field_tag "#{prefix}_full_address", address.try(:address_text), class: 'address_search' %>
  <% end  %>
</li>

<div class="selfclear non_geocoding_address" style="display: none;">
  <li class="selfclear">
    <%= form.label :address, translate_helper("address") %>
    <%= form.text_field :address, class: 'address_text' %>
  </li>

  <li class="selfclear">
    <%= form.label :city, translate_helper("city") %>
    <%= form.text_field :city , class: 'address_city' %>
  </li>

  <li class="selfclear">
    <%= form.label :state, translate_helper("state") %>
    <%= form.text_field :state, :size=>2, :maxlength=> 2, :class => 'address_state', :data => {:convert => 'uppercase'} %>
  </li>

  <li class="selfclear">
    <%= form.label :zip, translate_helper("zip") %>
    <%= form.text_field :zip, class: 'address_zip'  %>
  </li>
</div>

<li class="selfclear">
  <%= form.label :phone_number, translate_helper("phone_number") %>
  <%= form.text_field :phone_number %>
</li>

<li class="selfclear">
  <%= form.label :default_trip_purpose, translate_helper("default_trip_purpose") %>
  <%= form.select :trip_purpose_id, TripPurpose.by_provider(current_provider).map { |tp| [tp.name, tp.id] }, :include_blank => true %>
</li>

<li class="selfclear">
  <%= form.label :in_district, translate_helper("in_district") %>
  <%= form.select :in_district, [[translate_helper("unspecified"),nil], [translate_helper("yes"), true], [translate_helper("no"), false]] %>
</li>

<li class="selfclear">
  <%= form.label :notes, translate_helper("address_notes") %>
  <%= form.text_area :notes %>
</li>

<%= render 'addresses/google_place_autocomplete_js' if prefix != 'pickup' %>

<script type="text/javascript">
  $(function() {
    // Force uppercase text for OFT inputs
    $('[data-convert="uppercase"]').keyup(function(evt) {
      this.value = this.value.toUpperCase();
    });
    
    $('.address_use_geocoder').change(function() {
      if($(this).prop('checked')) {
        $('.non_geocoding_address').hide();
        $('.full_address').show();

      } else {
        $('.full_address').hide();
        $('.non_geocoding_address').show();
      }

      $('.non_geocoding_address input').val('');
      $('.full_address input').val();
    });
  });
</script>