.panel.panel-success.run_trips_panel{id: "run_trips_panel_#{run.id}", data: {run_id: run.id}}
  .panel-heading
    .pull-right{style: 'padding-right: 0px;'}
      = render 'unschedule_trip_dropdown'
      %span.dispatch-action
        = link_to cancel_run_trips_runs_path(run_id: run.id), title: 'Cancel run', style: 'color: white;', remote: true, data: {confirm: 'Are you sure to cancel this run?'} do 
          %i.fa.fa-undo
      %span.dispatch-action
        = link_to edit_run_path(run, from_dispatch: true), style: 'color: white;', title: 'Edit' do 
          %i.fa.fa-pencil
      %span.dispatch-action
        = link_to new_trip_path(from_dispatch: true, run_id: run.id), style: 'color: white;', title: translate_helper("new_trip_link_text") do 
          %i.fa.fa-plus
      %span.panel-close.dispatch-action{title: 'Close'}
        %i.fa.fa-remove
      %span.panel-expand-collapse.dispatch-action{title: 'Collapse/expand'}
        %i.fa.fa-chevron-up
    %h3.panel-title.text-center
      .pull-left
        = run.name
      %span{style: 'font-size: small;'}
        = run_summary(run)
  .panel-body
    = render 'trips_runs/run_manifest_table', trips: run.trips

:javascript
  $("#run_trips_panel_#{run.id}").droppable({
    tolerance: 'pointer',
    hoverClass : 'drop-zone-active',
    drop: function(e, ui) {
      var source_panel = ui.draggable.parents('.panel');
      var prev_run_id = source_panel.data('run-id');
      var trip_id = null;
      if(prev_run_id) {
        trip_id = ui.draggable.data('trip-id');
      } else {
        trip_id = ui.draggable.parents('tr').data('trip-id');
      }
      var run_id = #{run.id};
      if(prev_run_id == run_id) {
        // TODO: same run, itinerary sequence change
      } else {
        schedule_trip(trip_id, run_id, prev_run_id);
      }
    }
  });

  $("#run_trips_panel_#{run.id} table tbody").sortable();