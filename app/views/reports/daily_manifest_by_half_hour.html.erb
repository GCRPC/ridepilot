
<% i = 0 %>
<% for driver, trips in @trips %>
  <% i += 1 %>

  <h1>Transportation Manifest</h1>
  <h2><%= format_date_for_daily_manifest @date %> &mdash; <%= driver.present? ? driver.name : 'Unspecified driver' %></h2>

  <% start_time = @query.start_date.to_datetime.advance :hours=>@start_hour %>
  
  <ul class="schedule">
    <% while start_time.hour < @end_hour %>
      <li>
        <% end_time = start_time.advance :minutes=>30 %>
        <% this_time = start_time %>
        <h3><%= start_time.strftime('%I:%M %P').gsub(/^0/,'') %></h3>
        <% for trip in trips %>
          <% if trip.pickup_time == start_time %>
            <%= render 'manifest_trip', :trip => trip %>
          <% end %>
        <% end %>
        <% for trip in trips %>
          <% if trip.pickup_time > start_time && trip.pickup_time < end_time %>
            <% if this_time != trip.pickup_time %>
              <% this_time = trip.pickup_time %>
              <h3><%= this_time.strftime('%I:%M %P').gsub(/^0/,'') %></h3>
            <% end %>
            <%= render 'manifest_trip', :trip => trip %>
          <% end %>
        <% end %>
      </li>
      <% start_time = start_time.advance :minutes=>30 %>
    <% end %>
  </ul>
  <% if i != @trips.size %>
    <br style="page-break-after:always" /> 
  <% end %>
<% end %>
