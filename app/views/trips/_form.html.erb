<%= form_for(@trip) do |f| %>
  <% if @trip.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@trip.errors.count, "error") %> prohibited this trip from being saved:</h2>

      <ul>
      <% @trip.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <!-- the customer id needs to be passed in this action -->
  <%= f.hidden_field :customer_id, :value=>@customer.id %>

  <fieldset class="new-trip">

    <ol class="section first">
      <li class="selfclear">
        <label for="customer">Customer:</label>
        <strong><%= @customer.name %></strong><!---------- TODO: Why is there a trailing ' .'? -->
      </li>

      <li class="selfclear time">
        <label for="pickup_time">Pickup time:</label>
        <%= f.text_field :pickup_time %>
      </li>

      <li class="selfclear time">
        <label for="appointment_time">Appointment time:</label>
        <%= f.text_field :appointment_time %>
      </li>

      <li class="selfclear">
        <!-- we need some complexity, because this form handles 
             both trips and repeating trips.
             So, we'll just put all the repeating stuff into
             plain params and handle it in the controller
          -->
        <label for="repeats_id">Repeats:</label>
        <div>
          <p>
            <input type="checkbox" name="monday" value="Monday" <%= @schedule.monday ? 'checked="checked"' : '' %>/> M&nbsp;
            <input type="checkbox" name="tuesday" value="Tuesday" <%= @schedule.tuesday ? 'checked="checked"' : '' %>/> T&nbsp;
            <input type="checkbox" name="wednesday" value="Wednesday" <%= @schedule.wednesday ? 'checked="checked"' : '' %>/> W&nbsp;
            <input type="checkbox" name="thursday" value="Thursday" <%= @schedule.thursday ? 'checked="checked"' : '' %>/> R&nbsp;
            <input type="checkbox" name="friday" value="Friday" <%= @schedule.friday ? 'checked="checked"' : '' %>/> F&nbsp;
          </p>
          every <input type="text" size="2" name="interval" id="interval" value="<%= @schedule.interval %>"/> week(s)
        </div>
<!-- TODO: make repeats checkboxes work in Rails -->
      </li>

<!-- TODO: autocomplete / geocode here -->
      <li class="selfclear">
        <label for="pickup_address_id">Pickup address:</label>
        <%= f.text_field(:pickup_address_id, :class => "full") %>
      </li>

      <li class="selfclear">
        <label for="pickup_address_id">Dropoff address:</label>
        <%= f.text_field(:dropoff_address_id, :class => "full") %>
      </li>

      <li class="selfclear">
        <label for="phone">Phone:</label>
        <input type="text" size="14" name="phone" id="phoned" value="<%= @customer.phone_number_1 %>" readonly="readonly"/>
      </li>

      <li class="selfclear">
        <label for="alt_phone">Alt. Phone:</label>
        <input type="text" size="14" name="alt_phone" id="alt_phone" value="<%= @customer.phone_number_2 %>" readonly="readonly"/>

      </li>
    </ol>
    
    <ol class="section second">
      <li class="selfclear">
        <label for="trip_purpose">Trip purpose:</label>
        <%= f.select :trip_purpose, @trip_purposes %>
      </li>

      <li class="selfclear passengers">
        <label for="guest_count">Passengers:</label>
        <div>
          <p>
            <span class="nobreak"><%= f.text_field :guest_count %>&nbsp;Guests&nbsp;</span>
            <span class="nobreak"><%= f.text_field :attendant_count %>&nbsp;Attendants</span>
          </p>
          <input type="checkbox" name="monday" value="Monday" /> Group
        </div>
      </li>

      <li class="selfclear">
        <label for="vehicle_id">Vehicle:</label>
        <%= f.collection_select :vehicle_id, @vehicles, :id, :name %><br/>
      </li>

      <li class="selfclear">
        <label for="driver_notes">Customer Private Notes:</label>
        <textarea rows="20" name="customer_private_notes" id="customer_private_notes" cols="40" readonly="readonly"><%= @customer.private_notes %></textarea>
      </li>
    </ol>

    <ol class="section third">
      <li class="selfclear">
        <label for="result_id">Result:</label>
        <%= f.select :trip_result, @trip_results %>
      </li>

      <li class="selfclear donation">
        <label for="donation">Donation:</label>
        <%= f.text_field :donation %>
      </li>

      <li class="selfclear">
        <label for="funding_source_id">Funding source:</label>
        <%= f.collection_select :funding_source_id, @funding_sources, :id, :name %>
      </li>

      <li class="selfclear">
        <label for="mobility_id">Mobility Req.:</label>
        <%= f.collection_select :mobility_id, @mobilities, :id, :name %>
      </li>

      <li class="selfclear">
        <label for="mobility_notes">Mobility Notes:</label>
        <textarea rows="20" name="mobility_notes" id="mobility_notes" cols="40" readonly="readonly"><%= @customer.mobility_notes %></textarea>
      </li>
    </ol>

    <ol class="section fourth double">
      <li class="selfclear">
        <label for="notes">Trip Notes:</label>
        <%= f.text_area :notes %>
      </li>
      <li class="selfclear">
        <label for="customer_informed">Called back:</label>
        <%= f.check_box :customer_informed %>
        <% if @trip.customer_informed %>
          on <%= @trip.called_back_at %>
          by  <%= @trip.called_back_by.email %>
        <% end %>
      </li>
    </ol>

    <div class="actions">
      <%= f.submit %>
    </div>

  </fieldset>

<% end %>
